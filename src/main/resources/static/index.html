<!--<!DOCTYPE html>-->
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>数据对比</title>
    <link rel="stylesheet" type="text/css" href="element.css">
</head>
<style>
    .distort{
        color: #ef5a5a;
    }

    .unDistort{
        color: #333333;
    }
</style>
<body>
<div id="app">
    <el-button type="success" style="float: right; margin-right: 40px" @click="diff()">对比</el-button>
    <el-table
            :data="basicData"
            style="width: 100%"
            stripe="true" 
            fit="true" 
            @row-click="handleRowClick" 
            @selection-change="handleSelectionChange" 
            ref="multipleTable">
        <el-table-column
                type="selection"
                width="55">
        </el-table-column>
        
        <el-table-column
                fixed
                prop="id"
                label="序号"
                width="150">
        </el-table-column>
        
        <el-table-column prop="url"  label="IP地址">
            <template slot-scope="scope">
                <a :href="scope.row.url" target="_blank">{{scope.row.url}}</a>
            </template>
        </el-table-column>

        <el-table-column prop="isChange" label="是否被篡改">
            <template slot-scope="scope">
                <div :class="scope.row.isChange == '是'? 'distort' : 'unDistort' "> {{ scope.row.isChange }}</div>
            </template>
        </el-table-column>

        <el-table-column
                fixed="right"
                label="设置为基准线"
                width="120">
            <template slot-scope="scope">
                <el-button
                        @click.native.prevent="setData(scope.$index , basicData)"
                        type="text"
                        size="small">
                    {{basicData[scope.$index].key?'取消设置':'设置'}}
                </el-button>
            </template>
        </el-table-column>
    </el-table>
</div>
</body>
<script src="Vue.js"></script>
<script src="element.js"></script>
<script>
    var app = new Vue({
        el: '#app',
        methods: {

            //点击行触发，选中或不选中复选框
            handleRowClick: function(row, column, event){
                this.$refs.multipleTable.toggleRowSelection(row);
            },
            
            fetchData() {
                const loading = this.$loading({
                    lock: true,
                    text: 'Loading',
                    spinner: 'el-icon-loading',
                    background: 'rgba(0, 0, 0, 0.7)'
                });
                setTimeout(() => {
                    
                }, 2000);
                fetch('http://localhost:8080/', {
                    method: 'get',
                    headers: {
                        'Content-Type': 'application/json',
                    }
                }).then(res => res.json()).then((data) => {
                    this.basicData = data;
                    loading.close();
                }).catch(err => console.log(err))
            },

            diff() {
                const loading = this.$loading({
                    lock: true,
                    text: 'Loading',
                    spinner: 'el-icon-loading',
                    background: 'rgba(0, 0, 0, 0.7)'
                });
                setTimeout(() => {

                }, 2000);
                fetch('http://localhost:8080/diff', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(this.multipleSelection)
                }).then(res => res.json()).then((data) => {
                    this.basicData = data;
                    loading.close();
                }).catch(err => console.log(err))
            },

            handleSelectionChange(val) {
                this.multipleSelection = val;
            },

            setData(id, data) {
                const loading = this.$loading({
                    lock: true,
                    text: 'Loading',
                    spinner: 'el-icon-loading',
                    background: 'rgba(0, 0, 0, 0.7)'
                });
                setTimeout(() => {

                }, 2000);
                fetch('http://localhost:8080/set', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(this.basicData[id])
                }).then(res => res.json()).then((data) => {
                    this.basicData = data;
                    loading.close();
                }).catch(err => console.log(err))
            },
            
        },
        data: {
            cancel: '取消设置',
            set: '设置',
            basicData: [],
            multipleSelection: [],
        },

        mounted () {
            this.fetchData();
        },
    })
</script>


</html>